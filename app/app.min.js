(function() { var debugMode = false; 
/*!
 * Kraken 2017 CrossView.
 * http://alizarion.github.io/kraken
 *
 * Kraken, v1.0.0
 * Apache 2.0 license.*/
function uiCodemirrorDirective(e,o){function r(e,r,s,c){var l=angular.extend({value:r.text()},o.codemirror||{},e.$eval(s.uiCodemirror),e.$eval(s.uiCodemirrorOpts)),u=n(r,l);t(u,s.uiCodemirror||s.uiCodemirrorOpts,e),a(u,c,e),i(u,s.uiRefresh,e),e.$on("CodeMirror",function(e,o){if(!angular.isFunction(o))throw new Error("the CodeMirror event requires a callback function");o(u)}),angular.isFunction(l.onLoad)&&l.onLoad(u)}function n(e,o){var r;return"TEXTAREA"===e[0].tagName?r=window.CodeMirror.fromTextArea(e[0],o):(e.html(""),r=new window.CodeMirror(function(o){e.append(o)},o)),r}function t(e,o,r){function n(o,r){angular.isObject(o)&&t.forEach(function(n){if(o.hasOwnProperty(n)){if(r&&o[n]===r[n])return;e.setOption(n,o[n])}})}if(o){var t=Object.keys(window.CodeMirror.defaults);r.$watch(o,n,!0)}}function a(o,r,n){r&&(r.$formatters.push(function(e){if(angular.isUndefined(e)||null===e)return"";if(angular.isObject(e)||angular.isArray(e))throw new Error("ui-codemirror cannot use an object or an array as a model");return e}),r.$render=function(){var n=r.$viewValue||"";e(function(){o.setValue(n)},300)},o.on("change",function(e){var o=e.getValue();o!==r.$viewValue&&n.$evalAsync(function(){r.$setViewValue(o),n.$applyAsync(function(){n.$broadcast("compose:update:yaml"),n.$emit("compose:update:yaml")})})}))}function i(o,r,n){r&&n.$watch(r,function(r,n){r!==n&&e(function(){o.refresh()})})}return{restrict:"EA",require:"?ngModel",compile:function(){if(angular.isUndefined(window.CodeMirror))throw new Error("ui-codemirror needs CodeMirror to work... (o rly?)");return r}}}angular.module("kraken",["kraken.codemirror","ui.layout","ui.bootstrap","ng-clipboard","ui.router","ncy-angular-breadcrumb"]).config(["$compileProvider","$locationProvider","$qProvider",function(e,o,r){o.html5Mode(!1),o.hashPrefix(""),r.errorOnUnhandledRejections(!1),e.aHrefSanitizationWhitelist(/^\s*(https?|data|mailto|chrome-extension):/)}]),angular.module("kraken").config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|data|mailto|chrome-extension):/)}]),angular.module("kraken").config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("home",{url:"/home",cache:!1,controller:"HomeCtrl",templateUrl:"app/components/home/home.html",controllerAs:"home",ncyBreadcrumb:{label:"Home"}}).state({name:"home.edit",url:"/edit/:projectId?project&collection",templateUrl:"app/components/edit/edit.html",controller:"EditCtrl",controllerAs:"edit",ncyBreadcrumb:{label:"Edit {{edit.currentProject.name}}"}}),o.otherwise("/home")}]),angular.module("kraken.codemirror",[]).constant("uiCodemirrorConfig",{}).directive("uiCodemirror",["$timeout","uiCodemirrorConfig",uiCodemirrorDirective]),angular.module("kraken").directive("krVisNetwork",["util","LogService",function(e,o){return{restrict:"EA",transclude:!1,scope:{options:"=",jsonCompose:"=",composes:"=",project:"=",events:"="},link:function(o,r,n){function t(){if(null!=o.jsonCompose){var n=e.composeToVis(o.composes,o.options),t=new vis.DataSet(n.nodes),s=new vis.DataSet(n.edges);i.network?(i.data.nodes.forEach(function(e){t.get(e.id)||i.data.nodes.remove(e.id)}),i.data.edges.forEach(function(e){s.get(e.id)||i.data.edges.remove(e.id)}),i.data.nodes.update(n.nodes),i.data.edges.update(n.edges)):(i.data={nodes:t,edges:s},i.network=new vis.Network(r[0],i.data,i.visOption)),angular.forEach(o.events,function(e,o){a.indexOf(String(o))>=0&&i.network.on(o,e)}),null!=o.events&&null!=o.events.onload&&angular.isFunction(o.events.onload)&&o.events.onload(graph)}}var a=["click","doubleclick","oncontext","hold","release","selectNode","selectEdge","deselectNode","deselectEdge","dragStart","dragging","dragEnd","hoverNode","blurNode","zoom","showPopup","hidePopup","startStabilizing","stabilizationProgress","stabilizationIterationsDone","stabilized","resize","initRedraw","beforeDrawing","afterDrawing","animationFinished"],i=this;i.network=null,i.data=null,i.visOption={autoResize:!0,height:"100%",width:"100%",interaction:{navigationButtons:!0,keyboard:!1},physics:{forceAtlas2Based:{gravitationalConstant:-26,centralGravity:.005,springLength:230,springConstant:.18},maxVelocity:146,solver:"forceAtlas2Based",timestep:.35,stabilization:{enabled:!0,iterations:2e3,updateInterval:50}},layout:{randomSeed:34}},o.$watch("jsonCompose",function(){t()}),o.$watch("options.displayLinks",function(){t()}),o.$watch("options.displayDependsOn",function(){t()}),o.$watch("options.displayVolumes",function(){t()})}}}]),angular.module("kraken").filter("encodeURI",[function(){return window.encodeURIComponent}]),angular.module("kraken").factory("Compose",["$rootScope","util",function(e,o){function r(o){var r=this;return o?(o.color="#"+Math.floor(16777215*Math.random()).toString(16),o.name||(o.name="initial-default-docker-compose.yml"),o.json||(o.json={version:2,services:{proxy:{image:"httpd",ports:["80:80"]}}})):o={name:"initial-default-docker-compose.yml",color:"#"+Math.floor(16777215*Math.random()).toString(16),json:{version:2,services:{proxy:{image:"httpd",ports:["80:80"]}}}},o.$yaml=jsyaml.safeDump(o.json),e.$on("compose:update:yaml",function(){r.$reloadFromYaml()}),angular.extend(r,o||{})}return r.prototype.$reloadFromYaml=function(){this.$yaml&&(this.json=jsyaml.safeLoad(this.$yaml))},r.prototype.$reloadFromJson=function(){this.json&&(this.$yaml=jsyaml.safeDump(this.json))},r}]),angular.module("kraken").factory("Project",["Compose","LocalFileReader","$q","$window","LogService","util",function(e,o,r,n,t,a){function i(o){var r=this;return r.composes=[],r.id=a.UUID(),o&&(o.id&&(r.id=o.id),o.name&&(r.name=o.name),o.composes&&angular.forEach(o.composes,function(o){r.composes.push(new e(o))})),r}return i.prototype.$save=function(o){var r=localStorage.getItem(o),n=[];r&&(n=angular.fromJson(r));var s=this,c=null;if(s.fromShared){var l=i.$fromShared(s.fromShared);l.project&&(c=l.project.id)}s.composes.length<=0&&s.composes.push(new e);var u=i.$getById(c?c:this.id,o);u.position>=0?n.splice(u.position,1):n.id=a.UUID(),n.push(s),localStorage.setItem(o,angular.toJson(n)),t.info("Saved in your projects")},i.prototype.$refreshYamlFromJson=function(){var e=this;e.composes&&angular.forEach(e.composes,function(e){e.$reloadFromJson()})},i.$fromShared=function(e){var o=localStorage.getItem("kraken_projects"),r=[],n=null,t=-1;if(o){r=angular.fromJson(o);var a=!1;angular.forEach(r,function(o,r){a||o.fromShared===e&&(n=o,t=r)})}return n||console.warn("project with id "+e+"not found"),{project:n,position:t}},i.$loadAll=function(e){var o=localStorage.getItem(e),r=[],n=[];return o&&(r=angular.fromJson(o)),angular.forEach(r,function(e){n.push(new i(e))}),angular.forEach(n,function(e){e.$refreshYamlFromJson()}),n},i.prototype.getCompose=function(){var e=this,o=null;return angular.forEach(e.composes,function(e){o=angular.merge(e.json,o)}),o},i.$getById=function(e,o){var r=localStorage.getItem(o),n=[],t=null,a=-1;if(r){n=angular.fromJson(r);var i=!1;angular.forEach(n,function(o,r){i||o.id===e&&(t=o,a=r)})}return t||console.warn("project with id "+e+"not found"),{project:t,position:a}},i.prototype.$drop=function(e){var o=n.confirm("Are you sure you want to delete this project?");if(o){var r=localStorage.getItem(e),t=[];r&&(t=angular.fromJson(r));var a=i.$getById(this.id,e);a.position>=0&&t.splice(a.position,1),localStorage.setItem(e,angular.toJson(t))}},i.prototype.loadAllLocally=function(n){var t=this,a=r.defer(),i=[];return angular.forEach(n,function(r){i.push(o.readAsText(r).then(function(o){t.composes.push(new e({name:r.name,$yaml:o,json:jsyaml.safeLoad(o)}))}))}),r.all(i).then(function(){a.resolve(t.getCompose())},function(e){a.reject(e)}),a.promise},i}]),angular.module("kraken").directive("krFileSelect",[function(){return{restrict:"EA",scope:{getFile:"&"},link:function(e,o){o.bind("change",function(o){var r=(o.srcElement||o.target).files;e.getFile({files:r})})}}}]),function(e){var o=function(e,o,r){var n=function(e,o,r){return function(){r.$apply(function(){o.resolve(e.result)})}},t=function(e,o,r){return function(){r.$apply(function(){o.reject(e.result)})}},a=function(e,o){return function(e){o.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}},i=function(e,o){var r=new FileReader;return r.onload=n(r,e,o),r.onerror=t(r,e,o),r.onprogress=a(r,o),r},s=function(o){var n=e.defer(),t=i(n,r);return t.readAsText(o),n.promise};return{readAsText:s}};e.factory("LocalFileReader",["$q","$log","$rootScope",o])}(angular.module("kraken")),angular.module("kraken").service("LogService",[function(){var e=this;return e.history=[],{warn:function(o){e.history.push({type:"warning",message:o,date:new Date})},error:function(o){e.history.push({type:"danger",message:o,date:new Date})},info:function(o){e.history.push({type:"info",message:o,date:new Date})},history:e.history}}]).factory("$exceptionHandler",["$log","LogService",function(e,o){return function(r,n){o.error(r),e.warn(r,n)}}]),angular.module("kraken").service("ProjectService",["Project",function(e){var o=this;return o.refresh=function(){o.yourProjects=e.$loadAll("kraken_projects"),o.sharedProjects=e.$loadAll("shared_projects")},o.getLoadedProjects=function(){return o},o.getCurrentProject=function(){return o.currentProject},o.setCurrentProject=function(e){o.currentProject=e},o}]),angular.module("kraken").service("util",["LogService",function(e){function o(e,o){return{id:"service-"+e+"-depends-on-service-"+o,from:"service-"+e,to:"service-"+o,arrows:"to",physics:!1,color:"#ffb5bd",dashes:[2,2,20,20],chosen:{edge:function(e,o,r){e.color=r?"#ff2841":"ffb5bd",e.label=""}},smooth:{enabled:!0,type:"discrete",roundness:.2}}}function r(e,o){return{id:"network-"+e,label:c+e,size:10,color:"red",shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"#303336"},shadow:!0}}function n(e,o,r){return{id:"service-"+e+"-to-network-"+(o?o:"default"),from:"service-"+e,label:r?r:"",to:"network-"+(o?o:"default")}}function t(e,o,r){return{id:"volume-"+e,label:e,color:r}}function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function i(e,o,r){return{id:"service-"+e+"-to-volume-"+o,from:"service-"+e,label:r?r:"",dashes:[2,4],to:"volume-"+o}}function s(a,s){var u=[],d=[];for(var f in a){var p=null,m=a[f].json,h=a[f].color;if(m.networks){var v=m.networks;if("object"!=typeof m.networks&&Array.isArray(v))e.warn("expected an array of  networks, and simple string found");else for(var g in v){var y=v[g];if(y)if(y.external){if(y.external.name){var j=r(y.external.name);u.pushUnique(j),"default"===g&&(p=j)}}else u.pushUniqueNode(r(g));else u.pushUniqueNode(r(g))}}var w={};if(s&&s.displayVolumes&&m.volumes){var k=m.volumes;if(Array.isArray(k));else for(var b in k){var $=!1,P=k[b];k[b]&&P.external&&P.external.name&&(u.pushUniqueNode(t(P.external.name,m.color)),w[b]=P.external.name,$=!0),$||u.pushUniqueNode(t(b,m.color))}}p||u.pushUniqueNode(r("default"));var C;C=m.services?m.services:m;for(var A in C){var S=C[A];if(S){if(u.pushUniqueNode({id:"service-"+A,label:l+A,size:10,icon:{face:"FontAwesome",code:"",size:50,color:h},shape:"icon",shadow:!0}),S.networks)if(Array.isArray(S.networks)||"object"==typeof S.networks)for(var E in S.networks){var U=null,x=E,N=S.networks[x];if(Array.isArray(S.networks)?x=N?N:"":N&&N.aliases&&Array.isArray(N.aliases)&&angular.forEach(N.aliases,function(e){U=U?U+", "+(e?e:""):"aliases : "+(e?e:"")}),"default"===x&&p)d.pushUniqueNode(n(A,null,U));else{d.pushUniqueNode(n(A,x,U));var I={id:"network-"+x,label:c+x,size:10,color:"blue",shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"#777"},shadow:!0};u.arrayNodeIndexOf(I)<0&&u.pushUniqueNode(r(x)),e.warn("service "+A+" linked with  unknown network : "+x)}}else e.warn("expected an array of services networks, simple string found");else p?d.pushUniqueNode(n(A,null,null)):d.pushUniqueNode(n(A,null,null));if(S.depends_on&&s.displayDependsOn)if(Array.isArray(S.depends_on))for(var D in S.depends_on)d.pushUniqueNode(o(A,S.depends_on[D]));else for(var q in S.depends_on)d.pushUniqueNode(o(A,q));if(s&&s.displayVolumes&&S.volumes){var k=S.volumes;if(Array.isArray(k))for(var b in k){var P=k[b].split(":");w[P[0]]?(u.pushUniqueNode(t(w[P[0]],P[1])),d.pushUniqueNode(i(A,w[P[0]],P[1]))):(u.pushUniqueNode(t(P[0],P[1])),d.pushUniqueNode(i(A,P[0],P[1])))}}if(s){var M=S.links,L=S.external_links,O=[];if(Array.isArray(M)&&(O=O.concat(M)),Array.isArray(L)&&(O=O.concat(L)),O)for(var F in O)if(O[F]){var z=O[F].split(":");d.pushUniqueNode({id:"service-"+A+"-to-service-"+z[0]+"-as-"+z[1],from:"service-"+A,label:s.displayLinks?z[1]?z[1]:z[0]:"",arrows:"to",physics:!1,color:{opacity:s.displayLinks?1:0},chosen:{edge:function(e,o,r){e.color=r?"#a100ff":"#a5e2ff",e.label=""}},smooth:{enabled:!0,type:"discrete",roundness:.2},dashes:!0,to:"service-"+z[0]})}}}}}return{edges:d,nodes:u}}var c="network : ",l="service : ";return{composeToVis:s,UUID:a}}]),angular.module("kraken").controller("EditCtrl",["Project","LogService","$timeout","$scope","Compose","$stateParams","$uibModal","util",function(e,o,r,n,t,a,i,s){var c=this;a.projectId&&(c.currentProject=new e(e.$getById(a.projectId,a.collection).project),"shared_projects"===a.collection&&(c.currentProject.fromShared=c.currentProject.id,c.currentProject.id=s.UUID())),a.project&&LZMA.decompress(a.project.split(","),function(o){c.currentProject=new e(angular.fromJson(o)),e.$getById(c.currentProject.id,"kraken_projects").project?c.currentProject.$save("kraken_projects"):(c.currentProject.fromShared=c.currentProject.id,c.currentProject.$save("shared_projects"),c.currentProject.id=s.UUID()),c.refreshEditor()},function(e){document.title="Decompressing: "+100*e+"%"}),c.active=0,c.options={displayLinks:!0,displayDependsOn:!0,displayVolumes:!0},c.refreshEditor=function(){r(function(){n.$broadcast("CodeMirror",function(e){e.refresh()})},250)},c.removeCompose=function(e,o,r){var r=c.currentProject.composes.indexOf(e);r>=0&&(c.currentProject.composes.splice(r,1),c.currentProject.getCompose()),c.active=r-1>=0?r-1:0,c.refreshEditor(),o.preventDefault()},c.changeName=function(e,o){var r=prompt("Please the new name of your compose file",e.name);r&&(angular.forEach(c.currentProject.composes,function(o){o.name===e.name&&(r.indexOf(".yml")<0&&(r+=".yml"),o.name=r+"")}),c.currentProject.$save("kraken_projects")),c.refreshEditor(),o.preventDefault()},c.addNewCompose=function(e){var o=prompt("Please enter your docker compose file name",".yml");o&&c.currentProject.composes.push(new t({name:o})),c.refreshEditor(),e.preventDefault(),r(function(){c.active=c.currentProject.composes.length-1},100)},c.logService=o,c.share=function(){LZMA.compress(JSON.stringify(c.currentProject),5,function(e){var o=location.protocol+"//"+location.host+location.pathname+"#/home/edit/?project="+e;i.open({animation:!0,template:'<div class="modal-header"><h3 class="modal-title" id="modal-title-{{name}}">Your can Share this project by using the following link</h3></div>\n<div class="modal-body" id="modal-body-{{name}}">\n    <div class="input-group">\n        <input type="text" class="form-control" value="{{url}}" >\n        <span class="input-group-btn">\n        <button class="btn btn-secondary" ng-copy="url" type="button">Copy!</button>\n      </span>\n    </div>\n</div>',controller:["$scope",function(e){e.url=o}]})},function(e){document.title="Compressing: "+100*e+"%"})},c.downloadYaml=function(){var e=0,o=[];angular.forEach(c.currentProject.composes,function(){o.push(document.getElementById("downloadAnchorElem"+e)),e++}),setTimeout(function(){for(var e in o)o[e].click()},200)},c.editorOptions={lineWrapping:!0,lineNumbers:!0,matchTags:{bothTags:!0},extraKeys:{"Ctrl-Space":"autocomplete"},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],styleActiveLine:!0,theme:"dracula",lint:!0,mode:"text/x-yaml",smartIndent:!1,indentWithTabs:!1,commands:{save:function(){}}},c.refreshEditor()}]),angular.module("kraken").controller("HomeCtrl",["Project","$uibModal","$state","ProjectService","$scope",function(e,o,r,n,t){var a=this;a.projectService=n,a.projectService.refresh(),a.setCurrentProject=function(e){a.projectService.setCurrentProject(e),r.transitionTo("home.edit")},a.updateProjectName=function(e,o){var r=prompt("Please enter the new name of you project",e.name);r&&(e.name=r,e.$save("kraken_projects")),o.preventDefault()},a.createNewProject=function(){o.open({animation:!0,template:'<div class="container-fluid"><form novalidate><div class="modal-header"> <h3 class="modal-title" id="modal-title">Create new project</h3> </div><div class="modal-body" id="modal-body"><div class="form-group"> <label for="usr">Project Name:</label> <input type="text" required minlength="2" ng-model="project.name" class="form-control" id="usr"> </div> <ul><li ng-repeat="compose in project.composes">{{compose.name}} : <b>services </b> <span ng-repeat="(key,value) in compose.json.services">{{key}}, </span> </li></ul><label  class="btn btn-primary btn-lg btn-block btn-file">Import your Docker Compose files (Optional)<input type="file" multiple accept=".yml" kr-file-select get-file="project.loadAllLocally(files)" class="hidden"> </label></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button> </div></div></form>',controller:["$scope","Project","$uibModalInstance","ProjectService",function(e,o,r,n){e.project=new o,e.ok=function(){e.project.$save("kraken_projects"),n.refresh(),r.close()},e.cancel=function(){r.close()}}]})}}]);
})();