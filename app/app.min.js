(function() { var debugMode = false; 
/*!
 * Kraken 2017 CrossView.
 * http://alizarion.github.io/kraken
 *
 * Kraken, v1.0.0
 * Apache 2.0 license.*/
function uiCodemirrorDirective(e,o){function r(e,r,s,c){var l=angular.extend({value:r.text()},o.codemirror||{},e.$eval(s.uiCodemirror),e.$eval(s.uiCodemirrorOpts)),u=n(r,l);t(u,s.uiCodemirror||s.uiCodemirrorOpts,e),a(u,c,e),i(u,s.uiRefresh,e),e.$on("CodeMirror",function(e,o){if(!angular.isFunction(o))throw new Error("the CodeMirror event requires a callback function");o(u)}),angular.isFunction(l.onLoad)&&l.onLoad(u)}function n(e,o){var r;return"TEXTAREA"===e[0].tagName?r=window.CodeMirror.fromTextArea(e[0],o):(e.html(""),r=new window.CodeMirror(function(o){e.append(o)},o)),r}function t(e,o,r){function n(o,r){angular.isObject(o)&&t.forEach(function(n){if(o.hasOwnProperty(n)){if(r&&o[n]===r[n])return;e.setOption(n,o[n])}})}if(o){var t=Object.keys(window.CodeMirror.defaults);r.$watch(o,n,!0)}}function a(o,r,n){r&&(r.$formatters.push(function(e){if(angular.isUndefined(e)||null===e)return"";if(angular.isObject(e)||angular.isArray(e))throw new Error("ui-codemirror cannot use an object or an array as a model");return e}),r.$render=function(){var n=r.$viewValue||"";e(function(){o.setValue(n)},300)},o.on("change",function(e){var o=e.getValue();o!==r.$viewValue&&n.$evalAsync(function(){r.$setViewValue(o),n.$applyAsync(function(){n.$broadcast("compose:update:yaml"),n.$emit("compose:update:yaml")})})}))}function i(o,r,n){r&&n.$watch(r,function(r,n){r!==n&&e(function(){o.refresh()})})}return{restrict:"EA",require:"?ngModel",compile:function(){if(angular.isUndefined(window.CodeMirror))throw new Error("ui-codemirror needs CodeMirror to work... (o rly?)");return r}}}angular.module("kraken",["kraken.codemirror","ui.layout","ui.bootstrap","ui.router","ncy-angular-breadcrumb"]).config(["$compileProvider","$locationProvider",function(e,o){o.html5Mode(!1),o.hashPrefix(""),e.aHrefSanitizationWhitelist(/^\s*(https?|data|mailto|chrome-extension):/)}]),angular.module("kraken").config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|data|mailto|chrome-extension):/)}]),angular.module("kraken").config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("home",{url:"/home",controller:"HomeCtrl",templateUrl:"app/components/home/home.html",controllerAs:"home",ncyBreadcrumb:{label:"Home"}}).state({name:"home.edit",url:"/edit",templateUrl:"app/components/edit/edit.html",controller:"EditCtrl",controllerAs:"edit",ncyBreadcrumb:{label:"Edit {{edit.currentProject.name}}"}}),o.otherwise("/home")}]),angular.module("kraken.codemirror",[]).constant("uiCodemirrorConfig",{}).directive("uiCodemirror",["$timeout","uiCodemirrorConfig",uiCodemirrorDirective]),angular.module("kraken").directive("krVisNetwork",["util","LogService",function(e,o){return{restrict:"EA",transclude:!1,scope:{options:"=",jsonCompose:"=",events:"="},link:function(o,r,n){function t(){if(null!=o.jsonCompose){var n=e.composeToVis(o.jsonCompose,o.options),t=new vis.DataSet(n.nodes),s=new vis.DataSet(n.edges);i.network?(i.data.nodes.forEach(function(e){t.get(e.id)||i.data.nodes.remove(e.id)}),i.data.edges.forEach(function(e){s.get(e.id)||i.data.edges.remove(e.id)}),i.data.nodes.update(n.nodes),i.data.edges.update(n.edges)):(i.data={nodes:t,edges:s},i.network=new vis.Network(r[0],i.data,i.visOption)),angular.forEach(o.events,function(e,o){a.indexOf(String(o))>=0&&i.network.on(o,e)}),null!=o.events&&null!=o.events.onload&&angular.isFunction(o.events.onload)&&o.events.onload(graph)}}var a=["click","doubleclick","oncontext","hold","release","selectNode","selectEdge","deselectNode","deselectEdge","dragStart","dragging","dragEnd","hoverNode","blurNode","zoom","showPopup","hidePopup","startStabilizing","stabilizationProgress","stabilizationIterationsDone","stabilized","resize","initRedraw","beforeDrawing","afterDrawing","animationFinished"],i=this;i.network=null,i.data=null,i.visOption={autoResize:!0,height:"100%",width:"100%",interaction:{navigationButtons:!0,keyboard:!1},physics:{forceAtlas2Based:{gravitationalConstant:-26,centralGravity:.005,springLength:230,springConstant:.18},maxVelocity:146,solver:"forceAtlas2Based",timestep:.35,stabilization:{enabled:!0,iterations:2e3,updateInterval:50}},layout:{randomSeed:34}},o.$watch("jsonCompose",function(){t()}),o.$watch("options.displayLinks",function(){t()})}}}]),angular.module("kraken").factory("Compose",["$rootScope",function(e){function o(o){var r=this;return o?(o.name||(o.name="initial-default-docker-compose.yml"),o.json||(o.json={version:2,services:{proxy:{image:"httpd",ports:["80:80"]}}})):o={name:"initial-default-docker-compose.yml",json:{version:2,services:{proxy:{image:"httpd",ports:["80:80"]}}}},o.$yaml=jsyaml.safeDump(o.json),e.$on("compose:update:yaml",function(){r.$reloadFromYaml()}),angular.extend(r,o||{})}return o.prototype.$reloadFromYaml=function(){this.$yaml&&(this.json=jsyaml.safeLoad(this.$yaml))},o.prototype.$reloadFromJson=function(){this.json&&(this.$yaml=jsyaml.safeDump(this.json))},o}]),angular.module("kraken").factory("Project",["Compose","LocalFileReader","$q","$window",function(e,o,r,n){function t(o){var r=this;return r.composes=[],r.id=(new Date).getTime(),o&&(o.id&&(r.id=o.id),o.name&&(r.name=o.name),o.composes&&angular.forEach(o.composes,function(o){r.composes.push(new e(o))})),r}return t.prototype.$save=function(){var o=localStorage.getItem("kraken_projects"),r=[];o&&(r=angular.fromJson(o));var n=this;n.composes.length<=0&&n.composes.push(new e);var a=t.$getById(this.id);a.position>=0&&r.splice(a.position,1),r.push(n),localStorage.setItem("kraken_projects",angular.toJson(r))},t.prototype.$refreshYamlFromJson=function(){var e=this;e.composes&&angular.forEach(e.composes,function(e){e.$reloadFromJson()})},t.$loadAll=function(){var e=localStorage.getItem("kraken_projects"),o=[],r=[];return e&&(o=angular.fromJson(e)),angular.forEach(o,function(e){r.push(new t(e))}),angular.forEach(r,function(e){e.$refreshYamlFromJson()}),r},t.prototype.getCompose=function(){var e=this,o=null;return angular.forEach(e.composes,function(e){o=angular.merge(e.json,o)}),o},t.$getById=function(e){var o=localStorage.getItem("kraken_projects"),r=[],n=null,t=-1;if(o){r=angular.fromJson(o);var a=!1;angular.forEach(r,function(o,r){a||o.id===e&&(n=o,t=r)})}return n||console.warn("project with id "+e+"not found"),{project:n,position:t}},t.prototype.$drop=function(){var e=n.confirm("Are you sure you want to delete this project?");if(e){var o=localStorage.getItem("kraken_projects"),r=[];o&&(r=angular.fromJson(o));var a=t.$getById(this.id);a.position>=0&&r.splice(a.position,1),localStorage.setItem("kraken_projects",angular.toJson(r))}},t.prototype.loadAllLocally=function(n){var t=this,a=r.defer(),i=[];return angular.forEach(n,function(r){i.push(o.readAsText(r).then(function(o){t.composes.push(new e({name:r.name,$yaml:o,json:jsyaml.safeLoad(o)}))}))}),r.all(i).then(function(){a.resolve(t.getCompose())},function(e){a.reject(e)}),a.promise},t}]),angular.module("kraken").filter("encodeURI",[function(){return window.encodeURIComponent}]),angular.module("kraken").directive("krFileSelect",[function(){return{restrict:"EA",scope:{getFile:"&"},link:function(e,o){o.bind("change",function(o){var r=(o.srcElement||o.target).files;e.getFile({files:r})})}}}]),function(e){var o=function(e,o,r){var n=function(e,o,r){return function(){r.$apply(function(){o.resolve(e.result)})}},t=function(e,o,r){return function(){r.$apply(function(){o.reject(e.result)})}},a=function(e,o){return function(e){o.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}},i=function(e,o){var r=new FileReader;return r.onload=n(r,e,o),r.onerror=t(r,e,o),r.onprogress=a(r,o),r},s=function(o){var n=e.defer(),t=i(n,r);return t.readAsText(o),n.promise};return{readAsText:s}};e.factory("LocalFileReader",["$q","$log","$rootScope",o])}(angular.module("kraken")),angular.module("kraken").service("LogService",[function(){var e=this;return e.history=[],{warn:function(o){e.history.push({type:"warning",message:o,date:new Date})},error:function(o){e.history.push({type:"danger",message:o,date:new Date})},info:function(o){e.history.push({type:"info",message:o,date:new Date})},history:e.history}}]).factory("$exceptionHandler",["$log","LogService",function(e,o){return function(r,n){o.error(r),e.warn(r,n)}}]),angular.module("kraken").service("ProjectService",["Project",function(e){var o=this;return o.refresh=function(){o.loadedProjects=e.$loadAll()},o.getLoadedProjects=function(){return o.loadedProjects},o.getCurrentProject=function(){return o.currentProject},o.setCurrentProject=function(e){o.currentProject=e},o}]),angular.module("kraken").service("util",["LogService",function(e){function o(o,t){var a=[],i=[],s=null;if(o.networks){var c=o.networks;if(console.log(),"object"!=typeof o.networks&&Array.isArray(c))e.warn("expected an array of  networks, and simple string found");else for(var l in c){var u=c[l];if(u){if("object"==typeof u&&u.external&&u.external.name){var d={id:"networks-"+u.external.name,label:r+u.external.name,size:10,color:"red",shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"#303336"},shadow:!0};a.pushUnique(d),"default"===l&&(s=d)}}else a.pushUniqueNode({id:"networks-"+l,label:r+l,size:10,color:"red",shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"#303336"},shadow:!0})}}s||a.pushUniqueNode({id:"networks-default",label:r+"default",size:10,color:"red",shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"#303336"},shadow:!0});var f;f=o.services?o.services:o;for(var m in f){var p=f[m];if(p){if(a.pushUniqueNode({id:"services-"+m,label:n+m,size:10,icon:{face:"FontAwesome",code:"",size:50,color:"#4078c0"},shape:"icon",shadow:!0}),p.networks)if(Array.isArray(p.networks)||"object"==typeof p.networks)for(var h in p.networks){var v=null,g=h,w=p.networks[g];if(Array.isArray(p.networks)?g=w?w:"":w&&w.aliases&&Array.isArray(w.aliases)&&angular.forEach(w.aliases,function(e){v=v?v+", "+(e?e:""):"aliases : "+(e?e:"")}),"default"===g&&s)i.pushUniqueNode({id:"services-"+m+"-to-networks-default",from:"services-"+m,label:v?v:"",to:s.id});else{i.pushUniqueNode({id:"services-"+m+"-to-networks-"+g,from:"services-"+m,label:v?v:"",to:"networks-"+g});var k={id:"networks-"+g,label:r+g,size:10,color:"blue",shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"#777"},shadow:!0};a.arrayNodeIndexOf(k)<0&&a.pushUniqueNode({id:"networks-"+g,label:r+g,size:10,color:"blue",shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"#777"},shadow:!0}),e.warn("service "+m+" linked with  unknown network : "+g)}}else e.warn("expected an array of services networks, simple string found");else s?i.pushUniqueNode({id:"services-"+m+"-to-networks-default",from:"services-"+m,to:s.id}):i.pushUniqueNode({id:"services-"+m+"-to-networks-default",from:"services-"+m,to:"networks-default"});if(t&&p.links)for(var y in p.links)if(p.links[y]){var j=p.links[y].split(":");i.pushUniqueNode({id:"services-"+m+"-to-services-"+j[0]+"-as-"+j[1],from:"services-"+m,label:t.displayLinks?j[1]?j[1]:j[0]:"",arrows:"to",physics:!1,color:{opacity:t.displayLinks?1:0},chosen:{edge:function(e,o,r){e.color=r?"red":"black",e.label=""}},smooth:{enabled:!0,type:"discrete",roundness:.2},dashes:!0,to:"services-"+j[0]})}}}return{edges:i,nodes:a}}var r="network : ",n="service : ";return{composeToVis:o}}]),angular.module("kraken").controller("EditCtrl",["Project","LogService","$timeout","ProjectService","$scope","Compose",function(e,o,r,n,t,a){var i=this;i.currentProject=n.getCurrentProject()||new e,i.active=0,i.options={displayLinks:!0},i.refreshEditor=function(){r(function(){t.$broadcast("CodeMirror",function(e){e.refresh()})},250)},i.removeCompose=function(e,o,r){var r=i.currentProject.composes.indexOf(e);r>=0&&(i.currentProject.composes.splice(r,1),i.currentProject.getCompose()),i.active=r-1>=0?r-1:0,i.refreshEditor(),o.preventDefault()},i.changeName=function(e,o){var r=prompt("Please the new name of your compose file",e.name);r&&(angular.forEach(i.currentProject.composes,function(o){o.name===e.name&&(r.indexOf(".yml")<0&&(r+=".yml"),o.name=r+"")}),i.currentProject.$save()),i.refreshEditor(),o.preventDefault()},i.addNewCompose=function(e){var o=prompt("Please enter your docker compose file name",".yml");o&&i.currentProject.composes.push(new a({name:o})),i.refreshEditor(),e.preventDefault(),r(function(){i.active=i.currentProject.composes.length-1},100)},i.logService=o,i.downloadYaml=function(){var e=0,o=[];angular.forEach(i.currentProject.composes,function(){o.push(document.getElementById("downloadAnchorElem"+e)),e++}),setTimeout(function(){for(var e in o)o[e].click()},200)},i.editorOptions={lineWrapping:!0,lineNumbers:!0,matchTags:{bothTags:!0},extraKeys:{"Ctrl-Space":"autocomplete"},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],styleActiveLine:!0,theme:"dracula",lint:!0,mode:"text/x-yaml",smartIndent:!1,indentWithTabs:!1,commands:{save:function(){}}},i.refreshEditor()}]),angular.module("kraken").controller("HomeCtrl",["Project","$uibModal","$state","ProjectService","$scope",function(e,o,r,n,t){var a=this;a.projectService=n,a.projectService.refresh(),a.setCurrentProject=function(e){a.projectService.setCurrentProject(e),r.transitionTo("home.edit")},a.updateProjectName=function(e,o){var r=prompt("Please enter the new name of you project",e.name);r&&(e.name=r,e.$save()),o.preventDefault()},a.createNewProject=function(){o.open({animation:!0,template:'<div class="container-fluid"><form novalidate><div class="modal-header"> <h3 class="modal-title" id="modal-title">Create new project</h3> </div><div class="modal-body" id="modal-body"><div class="form-group"> <label for="usr">Project Name:</label> <input type="text" required minlength="2" ng-model="project.name" class="form-control" id="usr"> </div> <ul><li ng-repeat="compose in project.composes">{{compose.name}} : <b>services </b> <span ng-repeat="(key,value) in compose.json.services">{{key}}, </span> </li></ul><label  class="btn btn-primary btn-lg btn-block btn-file">Import your Docker Compose files (Optional)<input type="file" multiple accept=".yml" kr-file-select get-file="project.loadAllLocally(files)" class="hidden"> </label></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button> </div></div></form>',controller:["$scope","Project","$uibModalInstance","ProjectService",function(e,o,r,n){e.project=new o,e.ok=function(){e.project.$save(),n.refresh(),r.close()},e.cancel=function(){r.close()}}]})}}]);
})();